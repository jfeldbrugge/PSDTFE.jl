<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · PhaseSpaceDTFE.jl</title><meta name="title" content="Tutorial · PhaseSpaceDTFE.jl"/><meta property="og:title" content="Tutorial · PhaseSpaceDTFE.jl"/><meta property="twitter:title" content="Tutorial · PhaseSpaceDTFE.jl"/><meta name="description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="og:description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="twitter:description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="og:url" content="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/tutorial/"/><meta property="twitter:url" content="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/tutorial/"/><link rel="canonical" href="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/tutorial/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PhaseSpaceDTFE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../theory/">Theory</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#DTFE"><span>DTFE</span></a></li><li><a class="tocitem" href="#PS-DTFE"><span>PS-DTFE</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>We use the PhaseSpaceDTFE package to estimate the density and velocity fields of a GADGET-4 simulation. First, we load the data</p><pre><code class="language-julia hljs">using JLD2, Plots, HDF5, ProgressMeter, PhaseSpaceDTFE

## set up simulation box
Ni = 64
L  = 100.

depth = 5
sim_box = SimBox(L, Ni)  # note that need this custom struct for subbox

## load data
function load_data(file)
    fid = h5open(file, &quot;r&quot;)
    pos = convert.(Float64, read(fid[&quot;PartType1&quot;][&quot;Coordinates&quot;]))
    vel = convert.(Float64, read(fid[&quot;PartType1&quot;][&quot;Velocities&quot;]))
    ids = read(fid[&quot;PartType1&quot;][&quot;ParticleIDs&quot;])
    time = read_attribute(fid[&quot;Header&quot;], &quot;Time&quot;)
    close(fid)

    ordering = sortperm(ids)
    return (copy(pos[:,ordering]&#39;), copy(vel[:,ordering]&#39;), time)
end

function load_mass(file)
    f = h5open(file, &quot;r&quot;)
    read_attribute(f[&quot;Header&quot;], &quot;MassTable&quot;)[2]  # particle type 1
end

m = load_mass(&quot;../../test/data/snapshot_000.hdf5&quot;)
(coords_q, _, _) = load_data(&quot;../../test/data/snapshot_000.hdf5&quot;)
(coords_x, vels, _) = load_data(&quot;../../test/data/snapshot_002.hdf5&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([95.94856262207031 98.76901245117188 99.14542388916016; 99.86626434326172 97.77499389648438 97.80353546142578; … ; 94.38851928710938 97.52845764160156 0.3155221939086914; 94.68167114257812 97.48580169677734 99.97648620605469], [-292.1794128417969 -76.47138977050781 28.625730514526367; -60.02801513671875 -113.5673599243164 -126.30517578125; … ; -395.4625244140625 163.2576141357422 155.2444610595703; -418.26104736328125 123.40419006347656 328.3358459472656], 0.9999999999999997)</code></pre><h2 id="DTFE"><a class="docs-heading-anchor" href="#DTFE">DTFE</a><a id="DTFE-1"></a><a class="docs-heading-anchor-permalink" href="#DTFE" title="Permalink"></a></h2><p>When setting the initial positions to the final positions of the <span>$N$</span>-body particles, we recover the Delaunay Tessellation Field Estimator (DTFE) method</p><pre><code class="language-julia hljs">Range = 0.:0.2:100.
coords_arr  = [[L/2., y, z] for y in Range, z in Range]

dtfe_sb = ps_dtfe_subbox(coords_x, coords_x, vels, m, depth, sim_box; N_target=32)
density_field = density_subbox(coords_arr, dtfe_sb)
heatmap(Range, Range, log10.(density_field), aspect_ratio=:equal, xlims=(0, L), ylims=(0, L), c=:grays, xlabel=&quot;[Mpc]&quot;, ylabel=&quot;[Mpc]&quot;)</code></pre><img src="3275ab6f.svg" alt="Example block output"/><h2 id="PS-DTFE"><a class="docs-heading-anchor" href="#PS-DTFE">PS-DTFE</a><a id="PS-DTFE-1"></a><a class="docs-heading-anchor-permalink" href="#PS-DTFE" title="Permalink"></a></h2><p>For the Phase-Space Delaunay Tessellation Field Estimator (PS-DTFE), use the same routine using both the initial and final positions and velocities of the <span>$N$</span>-body particles.</p><pre><code class="language-julia hljs">## construct estimators with velocities
ps_dtfe_sb = ps_dtfe_subbox(coords_q, coords_x, vels, m, depth, sim_box; N_target=32)

## construct estimator without velocities
# ps_dtfe_sb = ps_dtfe_subbox(coords_q, coords_x, m, depth, sim_box; N_target=32)

## it is recommended to save the estimator object (holding the subbox references) for further use
save(&quot;ps_dtfe_sb.jld2&quot;, &quot;ps-dtfe-sb&quot;, ps_dtfe_sb)
ps_dtfe_sb = load(&quot;ps_dtfe_sb.jld2&quot;)[&quot;ps-dtfe-sb&quot;]
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Calculating 8 subbox estimators with 32^3 particles each (total simulation 64^3 particles).
subbox i, j, k = [0, 0, 0]
subbox i, j, k = [1, 0, 0]
<span class="sgr32">Progress:  25%|██████████▎                              |  ETA: 0:00:14</span>subbox i, j, k = [0, 1, 0]
<span class="sgr32">Progress:  38%|███████████████▍                         |  ETA: 0:00:12</span>subbox i, j, k = [1, 1, 0]
<span class="sgr32">Progress:  50%|████████████████████▌                    |  ETA: 0:00:10</span>subbox i, j, k = [0, 0, 1]
<span class="sgr32">Progress:  62%|█████████████████████████▋               |  ETA: 0:00:07</span>subbox i, j, k = [1, 0, 1]
<span class="sgr32">Progress:  75%|██████████████████████████████▊          |  ETA: 0:00:05</span>subbox i, j, k = [0, 1, 1]
<span class="sgr32">Progress:  88%|███████████████████████████████████▉     |  ETA: 0:00:02</span>subbox i, j, k = [1, 1, 1]
<span class="sgr32">Progress: 100%|█████████████████████████████████████████| Time: 0:00:19</span></code></pre><p>We evaluate the density field </p><pre><code class="language-julia hljs">density_field = density_subbox(coords_arr, ps_dtfe_sb)
heatmap(Range, Range, log10.(density_field), aspect_ratio=:equal, xlims=(0, L), ylims=(0, L), c=:grays, xlabel=&quot;[Mpc]&quot;, ylabel=&quot;[Mpc]&quot;)</code></pre><img src="d1bf4e38.svg" alt="Example block output"/><p>the number of streams</p><pre><code class="language-julia hljs">number_field = numberOfStreams_subbox(coords_arr, ps_dtfe_sb)
heatmap(Range, Range, log10.(number_field), aspect_ratio=:equal, xlims=(0, L), ylims=(0, L), xlabel=&quot;[Mpc]&quot;, ylabel=&quot;[Mpc]&quot;)</code></pre><img src="57e9d5e7.svg" alt="Example block output"/><p>and the mass weighted velocity field</p><pre><code class="language-julia hljs">Range = 0.:0.2:100.
coords_arr  = [[L/2., y, z] for y in Range, z in Range]
velocitySum_field = velocitySum_subbox(coords_arr, ps_dtfe_sb)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">501×501×3 Array{Float64, 3}:
[:, :, 1] =
 20.1516  21.0907  22.0298  22.9689  …  17.975   18.9141  19.8532  20.7923
 19.3726  20.3117  21.2508  22.1899     17.196   18.1351  19.0742  20.0133
 18.5935  19.5326  20.4717  43.239      16.4169  17.356   18.2951  19.2342
 29.5419  31.6174  33.693   27.9361     23.3152  25.3908  27.4663  29.5419
 30.2414  32.317   34.3925  28.6686     24.0147  26.0903  28.1659  30.2414
 30.941   33.0165  27.1964  29.4011  …  24.7143  26.7899  28.8654  30.941
 31.6405  33.7161  27.9288  30.1335     25.4139  27.4894  29.565   31.6405
 32.3401  34.4156  28.6613  30.866      26.1134  28.189   30.2645  32.3401
 33.0396  27.1891  29.3938  31.5984     26.813   28.8885  30.9641  33.0396
 33.7392  27.9215  30.1262  32.3309     27.5125  29.5881  31.6636  33.7392
  ⋮                                  ⋱                              ⋮
 23.5238  23.8628  28.6907  28.5849     29.4818  29.7785  33.5608  33.8998
 20.8546  21.1936  26.9139  26.8081     26.8746  27.1714  27.4682  31.2306
 20.5576  18.5244  25.1371  25.0313     24.2675  24.5643  24.8611  25.1579
 17.9504  18.2472  48.4496  49.3582  …  21.6604  21.9572  22.254   22.5507
 15.3433  24.539   25.4949  48.6354     19.0533  19.3501  19.6468  19.9436
 22.7914  23.7474  24.7033  25.6593     16.4461  16.7429  21.8355  22.7914
 21.9998  22.9558  23.9117  24.8677     19.132   20.0879  21.0439  21.9998
 20.9307  21.8697  22.8088  23.7479     18.3404  19.2963  20.2523  43.6543
 20.1516  21.0907  22.0298  22.9689  …  40.058   40.9971  41.9362  42.8752

[:, :, 2] =
  -93.5948   -96.5458   -99.4968  -102.448   …   -62.4133  -65.3644  -68.3154
  -91.4624   -94.4134   -97.3644  -100.315       -60.2809  -63.232   -66.183
  -89.33     -92.281    -95.232    -74.6749      -58.1485  -61.0996  -64.0506
  -77.6228   -79.646    -81.6691   -87.3386      -73.5765  -75.5996  -77.6228
  -74.2832   -76.3064   -78.3295   -84.0378      -70.2369  -72.2601  -74.2832
  -70.9436   -72.9668   -78.5618   -80.737   …   -66.8973  -68.9205  -70.9436
  -67.604    -69.6272   -75.2609   -77.4362      -63.5577  -65.5809  -67.604
  -64.2645   -66.2876   -71.9601   -74.1353      -60.2181  -62.2413  -64.2645
  -60.9249   -66.484    -68.6593   -70.8345      -56.8785  -58.9017  -60.9249
  -57.5853   -63.1832   -65.3584   -67.5337      -53.539   -55.5621  -57.5853
    ⋮                                        ⋱                         ⋮
 -119.438   -121.311   -102.234   -104.039      -100.156   -97.5134  -99.3862
 -115.989   -117.862    -98.9214  -100.726       -96.626   -98.5541  -95.9372
 -109.429   -114.413    -95.6085   -97.4135      -93.0956  -95.0237  -96.9519
 -105.899   -107.827   -117.688   -120.52    …   -89.5652  -91.4933  -93.4215
 -102.368    -97.0862   -99.6317  -118.273       -86.0348  -87.963   -89.8911
  -92.7107   -95.2562   -97.8017  -100.347       -82.5045  -90.1652  -92.7107
  -90.8807   -93.4262   -95.9717   -98.5171      -85.7897  -88.3352  -90.8807
  -95.7272   -98.6782  -101.629   -104.58        -83.9597  -86.5052  -76.7228
  -93.5948   -96.5458   -99.4968  -102.448   …   -68.6884  -71.6394  -74.5904

[:, :, 3] =
 19.9205    22.5577   25.1949   27.8321   …  21.4816    24.1187    26.7559
 17.5128    20.1499   22.7871   25.4243      19.0738    21.711     24.3481
 15.105     17.7422   20.3793   31.7286      16.666     19.3032    21.9404
 12.427     15.038    17.649    23.856        7.20503    9.81601   12.427
  9.98515   12.5961   15.2071   21.2839       4.76318    7.37417    9.98515
  7.54331   10.1543   16.6119   18.7117   …   2.32133    4.93232    7.54331
  5.10146    7.71245  14.0398   16.1396      -0.120514   2.49047    5.10146
  2.65961    5.2706   11.4677   13.5675      -2.56236    0.048626   2.65961
  0.217766   6.79571   8.89554  10.9954      -5.00421   -2.39322    0.217766
 -2.22408    4.22359   6.32342   8.42325     -7.44605   -4.83507   -2.22408
  ⋮                                       ⋱                         ⋮
 41.8641    44.9003   51.7351   55.213       40.0366    36.7813    39.8176
 40.4739    43.5102   49.4589   52.9368      38.533     41.6464    38.4274
 34.7492    42.1201   47.1828   50.6607      37.0294    40.1429    43.2563
 33.2457    36.3591   32.2909   35.2588   …  35.5258    38.6393    41.7527
 31.7421    34.483    37.2367   32.4526      34.0223    37.1357    40.2492
 29.2348    31.9884   34.7421   37.4957      32.5187    26.4812    29.2348
 26.7402    29.4938   32.2474   35.0011      21.2329    23.9866    26.7402
 22.3283    24.9655   27.6027   30.2398      18.7383    21.4919    20.6873
 19.9205    22.5577   25.1949   27.8321   …  13.0052    15.6423    18.2795</code></pre><p>Clear temporary files</p><pre><code class="language-julia hljs">rm(&quot;ps_dtfe&quot;, recursive=true)
rm(&quot;ps_dtfe_sb.jld2&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../theory/">« Theory</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 25 July 2025 10:02">Friday 25 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
